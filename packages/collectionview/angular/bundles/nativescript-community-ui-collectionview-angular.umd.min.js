!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@nativescript/core"),require("@nativescript-community/ui-collectionview"),require("@nativescript/angular")):"function"==typeof define&&define.amd?define("@nativescript-community/ui-collectionview-angular",["exports","@angular/core","@nativescript/core","@nativescript-community/ui-collectionview","@nativescript/angular"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self)["nativescript-community"]=e["nativescript-community"]||{},e["nativescript-community"]["ui-collectionview-angular"]={}),e.ng.core,e["ns-core"],e["ns-ui-collectionview"],e["ns-angular"])}(this,(function(e,t,i,n,o){"use strict";var r=["loader"];o.registerElement("CollectionView",(function(){return n.CollectionView}));var a="_ngViewRef",s=function(e,t,i,n,o){this.$implicit=e,this.item=t,this.index=i,this.even=n,this.odd=o},c=function(){function e(e,i){var o=this;this._iterableDiffers=i,this.setupItemView=new t.EventEmitter,this.itemViewLoader=function(e){switch(e){case n.ListViewViewTypes.ItemView:if(o._itemTemplate&&o.loader){var t=o.loader.createEmbeddedView(o._itemTemplate,new s,0),i=l(t);return i[a]=t,i}}return null},this._collectionView=e.nativeElement,this._collectionView.on(n.CollectionView.itemLoadingEvent,this.onItemLoading,this),this._collectionView.itemViewLoader=this.itemViewLoader}return Object.defineProperty(e.prototype,"nativeElement",{get:function(){return this._collectionView},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"listView",{get:function(){return this._collectionView},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"itemTemplate",{get:function(){return this._itemTemplate},set:function(e){this._itemTemplate=e,this._collectionView.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},set:function(e){this._items=e;var n=!0;e instanceof i.ObservableArray&&(n=!1),n&&!this._differ&&t.ɵisListLikeIterable(e)&&(this._differ=this._iterableDiffers.find(this._items).create((function(e,t){return t}))),this._collectionView.items=this._items},enumerable:!1,configurable:!0}),e.prototype.ngAfterContentInit=function(){i.Trace.isEnabled()&&n.CLog(n.CLogTypes.info,"CollectionView.ngAfterContentInit()"),this.setItemTemplates()},e.prototype.ngOnDestroy=function(){this._collectionView.off(n.CollectionView.itemLoadingEvent,this.onItemLoading,this)},e.prototype.ngDoCheck=function(){(i.Trace.isEnabled()&&n.CLog(n.CLogTypes.info,"ngDoCheck() - execute differ? "+this._differ),this._differ)&&(i.Trace.isEnabled()&&n.CLog(n.CLogTypes.info,"ngDoCheck() - execute differ"),this._differ.diff(this._items)&&(i.Trace.isEnabled()&&n.CLog(n.CLogTypes.info,"ngDoCheck() - refresh"),this.refresh()))},e.prototype.registerTemplate=function(e,t){i.Trace.isEnabled()&&n.CLog(n.CLogTypes.info,"registerTemplate for key: "+e),this._templateMap||(this._templateMap=new Map);var o={key:e,createView:this.getItemTemplateViewFactory(t)};this._templateMap.set(e,o)},e.prototype.onItemLoading=function(e){if((e.view||this.itemTemplate)&&this.items){var t,o=e.index,r=e.object.items,c="function"==typeof r.getItem?r.getItem(o):r[o];i.Trace.isEnabled()&&n.CLog(n.CLogTypes.info,"onItemLoading: "+o+" - Reusing existing view"),!(t=e.view[a])&&e.view instanceof i.LayoutBase&&e.view.getChildrenCount()>0&&(t=e.view.getChildAt(0)[a]),!t&&i.Trace.isEnabled()&&i.Trace.isEnabled()&&n.CLog(n.CLogTypes.info,"ViewReference not found for item "+o+". View recycling is not working"),t||(i.Trace.isEnabled()&&n.CLog(n.CLogTypes.info,"onItemLoading: "+o+" - Creating view from template"),t=this.loader.createEmbeddedView(this.itemTemplate,new s,0),e.view=l(t),e.view[a]=t),this.setupViewRef(t,c,o),this.detectChangesOnChild(t,o)}},e.prototype.setupViewRef=function(e,t,i){var n=e.context;n.$implicit=t,n.item=t,n.index=i,n.even=i%2==0,n.odd=!n.even,this.setupItemView.next({context:n,data:t,index:i,view:e})},e.prototype.getItemTemplateViewFactory=function(e){var t=this;return function(){var i=t.loader.createEmbeddedView(e,new s,0),n=l(i);return n[a]=i,n}},e.prototype.setItemTemplates=function(){if(this.itemTemplate=this.itemTemplateQuery,this._templateMap){i.Trace.isEnabled()&&n.CLog(n.CLogTypes.info,"Setting templates");var e=[];this._templateMap.forEach((function(t){e.push(t)})),this._collectionView.itemTemplates=e}else this._collectionView.itemTemplate=this.getItemTemplateViewFactory(this.itemTemplate)},e.prototype.detectChangesOnChild=function(e,t){i.Trace.isEnabled()&&n.CLog(n.CLogTypes.info,"Manually detect changes in child: "+t),e.markForCheck(),e.detectChanges()},e.prototype.refresh=function(){this._collectionView&&this._collectionView.refresh()},e}();function l(e,t){return void 0===t&&(t=o.getSingleViewRecursive),t(e.rootNodes,0)}c.ɵfac=function(e){return new(e||c)(t.ɵɵdirectiveInject(t.ElementRef),t.ɵɵdirectiveInject(t.IterableDiffers))},c.ɵcmp=t.ɵɵdefineComponent({type:c,selectors:[["CollectionView"]],contentQueries:function(e,i,n){var o;(1&e&&t.ɵɵstaticContentQuery(n,t.TemplateRef,!0,t.TemplateRef),2&e)&&(t.ɵɵqueryRefresh(o=t.ɵɵloadQuery())&&(i.itemTemplateQuery=o.first))},viewQuery:function(e,i){var n;(1&e&&t.ɵɵstaticViewQuery(r,!0,t.ViewContainerRef),2&e)&&(t.ɵɵqueryRefresh(n=t.ɵɵloadQuery())&&(i.loader=n.first))},inputs:{itemTemplate:"itemTemplate",items:"items"},outputs:{setupItemView:"setupItemView"},decls:3,vars:0,consts:[["loader",""]],template:function(e,i){1&e&&(t.ɵɵelementStart(0,"DetachedContainer"),t.ɵɵelement(1,"Placeholder",null,0),t.ɵɵelementEnd())},encapsulation:2,changeDetection:0}),t.ɵsetClassMetadata(c,[{type:t.Component,args:[{selector:"CollectionView",template:"\n        <DetachedContainer>\n            <Placeholder #loader></Placeholder>\n        </DetachedContainer>\n    ",changeDetection:t.ChangeDetectionStrategy.OnPush}]}],(function(){return[{type:t.ElementRef,decorators:[{type:t.Inject,args:[t.ElementRef]}]},{type:t.IterableDiffers,decorators:[{type:t.Inject,args:[t.IterableDiffers]}]}]}),{loader:[{type:t.ViewChild,args:["loader",{read:t.ViewContainerRef,static:!0}]}],setupItemView:[{type:t.Output}],itemTemplateQuery:[{type:t.ContentChild,args:[t.TemplateRef,{read:t.TemplateRef,static:!0}]}],itemTemplate:[{type:t.Input}],items:[{type:t.Input}]});var p=function(){function e(e,t){this.templateRef=e,this.collectionView=t}return Object.defineProperty(e.prototype,"cvTemplateKey",{set:function(e){i.Trace.isEnabled()&&n.CLog(n.CLogTypes.info,"cvTemplateKey: "+e),this.collectionView&&this.templateRef&&this.collectionView.registerTemplate(e.toLowerCase(),this.templateRef)},enumerable:!1,configurable:!0}),e}();p.ɵfac=function(e){return new(e||p)(t.ɵɵdirectiveInject(t.TemplateRef),t.ɵɵdirectiveInject(c,1))},p.ɵdir=t.ɵɵdefineDirective({type:p,selectors:[["","cvTemplateKey",""]],inputs:{cvTemplateKey:"cvTemplateKey"}}),t.ɵsetClassMetadata(p,[{type:t.Directive,args:[{selector:"[cvTemplateKey]"}]}],(function(){return[{type:t.TemplateRef},{type:c,decorators:[{type:t.Host}]}]}),{cvTemplateKey:[{type:t.Input}]});var f=function(){};f.ɵmod=t.ɵɵdefineNgModule({type:f}),f.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||f)}}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(f,{declarations:[c,p],exports:[c,p]}),t.ɵsetClassMetadata(f,[{type:t.NgModule,args:[{declarations:[c,p],exports:[c,p],schemas:[t.NO_ERRORS_SCHEMA]}]}],null,null),e.CollectionViewComponent=c,e.CollectionViewModule=f,e.TemplateKeyDirective=p,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=nativescript-community-ui-collectionview-angular.umd.min.js.map